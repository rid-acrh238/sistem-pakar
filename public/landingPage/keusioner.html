<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindCare - Deteksi Dini Depresi</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Inter', 'Poppins', 'sans-serif'],
                        'heading': ['Poppins', 'Inter', 'sans-serif']
                    },
                    colors: {
                        'mindful': {
                            'light': '#C5E4F3',
                            'primary': '#5DADE2',
                            'DEFAULT': '#3498DB',
                            'dark': '#2874A6',
                            'darker': '#1B4F72'
                        },
                        'calm': {
                            'light': '#D5DBDB',
                            'primary': '#A3E4D7',
                            'DEFAULT': '#48C9B0',
                            'dark': '#17A589'
                        },
                        'danger': {
                             'light': '#FADBD8',
                             'DEFAULT': '#E74C3C',
                             'dark': '#C0392B'
                        }
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-slow': 'pulse 3s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-15px)' }
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        .step-section { 
            display: none;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        .step-section.active { 
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #f0f4f8 0%, #dbeafe 100%);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #5DADE2 0%, #3498DB 100%);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.4);
        }

        /* --- GAYA KUESIONER --- */
        .custom-radio { display: none; }
        
        .radio-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 16px 10px;
            border: 2px solid #E2E8F0;
            border-radius: 12px;
            background-color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            height: 100%;
        }
        
        .radio-option:hover {
            border-color: #5DADE2;
            background-color: #F7FBFE;
            transform: translateY(-2px);
        }
        
        .custom-radio:checked + .radio-option {
            border-color: #3498DB;
            background-color: #E8F4FC;
            color: #1B4F72;
            font-weight: 500;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.1);
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="gradient-bg text-slate-800 min-h-screen flex flex-col font-sans">

    <nav class="w-full bg-white/90 backdrop-blur-md border-b border-slate-100 fixed top-0 z-50 shadow-sm transition-all duration-300">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-3 cursor-pointer" onclick="location.reload()">
                <div class="bg-mindful-light p-2 rounded-lg">
                    <i class="fas fa-brain text-mindful-darker text-xl"></i>
                </div>
                <div>
                    <h1 class="text-xl font-heading font-bold text-mindful-darker">MindCare</h1>
                </div>
            </div>
            
            <div class="hidden md:flex items-center space-x-8">
                <a href="./diagnosa.html#home" class="text-slate-600 hover:text-mindful font-medium transition">Beranda</a>
                <a href="./diagnosa.html#about" class="text-slate-600 hover:text-mindful font-medium transition">Tentang Kami</a>
                <a href="#" class="text-slate-600 hover:text-mindful font-medium transition">Layanan</a>
                <a href="#" class="text-slate-600 hover:text-mindful font-medium transition">Kontak</a>
            </div>

            <div class="flex items-center space-x-2">
                <span class="text-xs font-semibold text-white px-3 py-1 bg-mindful rounded-full shadow-sm">
                    <i class="fas fa-robot mr-1"></i> AI Expert System
                </span>
            </div>
        </div>
    </nav>

    <main class="flex-grow pt-28 pb-12 px-4">
        <div class="max-w-5xl mx-auto">
            
            <div class="sticky top-24 z-30 bg-white/80 backdrop-blur rounded-xl p-4 mb-8 shadow-sm border border-slate-100" id="progress-container">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-xs font-bold uppercase tracking-wider text-slate-500" id="step-indicator">Langkah 1: Pendahuluan</span>
                    <span class="text-xs font-bold text-mindful-dark" id="step-percentage">0%</span>
                </div>
                <div class="h-2 w-full bg-slate-100 rounded-full overflow-hidden">
                    <div class="h-full bg-mindful transition-all duration-700 ease-out" id="progress-fill" style="width: 0%"></div>
                </div>
            </div>

            <section id="step-1" class="step-section active" data-aos="fade-up">
                <div class="text-center py-10">
                    <div class="relative w-full max-w-lg mx-auto mb-12">
                        <div class="absolute top-0 -left-4 w-72 h-72 bg-purple-200 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob"></div>
                        <div class="absolute top-0 -right-4 w-72 h-72 bg-mindful-light rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob animation-delay-2000"></div>
                        <div class="absolute -bottom-8 left-20 w-72 h-72 bg-pink-200 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob animation-delay-4000"></div>
                        
                        <div class="relative">
                            <img src="https://img.freepik.com/free-vector/mental-health-awareness-concept-illustration_114360-2036.jpg" 
                                 alt="Mental Health Check" class="w-full rounded-2xl shadow-2xl transform hover:scale-105 transition duration-500">
                        </div>
                    </div>

                    <h1 class="text-4xl md:text-6xl font-heading font-bold text-slate-800 mb-6">
                        Pahami Kondisi <span class="text-mindful">Kesehatan Mental</span> Anda
                    </h1>
                    <p class="text-lg text-slate-600 max-w-2xl mx-auto mb-10 leading-relaxed">
                        Sistem pakar diagnosa awal depresi menggunakan metode <b>Forward-Chaining</b> berdasarkan standar DSM-5. Deteksi dini adalah langkah awal menuju pemulihan.
                    </p>

                    <button onclick="nextStep(2)" class="btn-primary text-white text-xl font-semibold py-4 px-12 rounded-full shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition flex items-center mx-auto group">
                        <span>Mulai Tes Screening</span>
                        <i class="fas fa-arrow-right ml-3 group-hover:translate-x-1 transition"></i>
                    </button>

                    <div class="mt-12 grid grid-cols-1 md:grid-cols-3 gap-6 max-w-3xl mx-auto">
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                            <i class="fas fa-user-shield text-mindful text-2xl mb-3"></i>
                            <h3 class="font-bold text-slate-700">Privasi Terjaga</h3>
                            <p class="text-sm text-slate-500">Data anonim & rahasia.</p>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                            <i class="fas fa-clipboard-check text-calm text-2xl mb-3"></i>
                            <h3 class="font-bold text-slate-700">Standar Medis</h3>
                            <p class="text-sm text-slate-500">Berbasis kriteria DSM-5.</p>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                            <i class="fas fa-bolt text-yellow-400 text-2xl mb-3"></i>
                            <h3 class="font-bold text-slate-700">Hasil Instan</h3>
                            <p class="text-sm text-slate-500">Analisa langsung dengan AI.</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="step-2" class="step-section">
                <div class="bg-white rounded-3xl shadow-xl overflow-hidden border border-slate-100">
                    <div class="bg-mindful/10 p-8 border-b border-mindful/20">
                        <h2 class="text-2xl font-heading font-bold text-slate-800">Kuesioner Gejala</h2>
                        <div class="flex items-start mt-3 bg-white p-4 rounded-lg border-l-4 border-mindful shadow-sm">
                            <i class="fas fa-info-circle text-mindful text-xl mr-3 mt-1"></i>
                            <p class="text-slate-600 text-sm">
                                <strong>PENTING:</strong> Pertanyaan di bawah ini menanyakan seberapa sering Anda terganggu oleh masalah-masalah berikut dalam <span class="text-mindful-dark font-bold underline">2 minggu terakhir</span>.
                            </p>
                        </div>
                    </div>
                    
                    <div class="p-6 md:p-10">
                        <form id="quiz-form" class="space-y-10">
                            <div id="question-container"></div>
                        </form>
                        
                        <div class="mt-10 pt-6 border-t border-slate-100 flex justify-between items-center">
                            <button onclick="prevStep(1)" class="text-slate-500 hover:text-slate-800 font-medium px-4 py-2 rounded-lg hover:bg-slate-100 transition">
                                <i class="fas fa-arrow-left mr-2"></i> Kembali
                            </button>
                            <button onclick="validateAndNext(3)" class="btn-primary text-white font-medium py-3 px-8 rounded-xl shadow-md flex items-center">
                                Lanjut ke Info Tambahan <i class="fas fa-chevron-right ml-2"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <section id="step-3" class="step-section">
                <div class="bg-white rounded-3xl shadow-xl p-6 border border-slate-100">
                    <h3 class="text-xl font-bold mb-4">Data Diri</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input type="text" id="nama" placeholder="Nama" class="p-3 border rounded-lg" required>
                        <input type="email" id="email" placeholder="Email" class="p-3 border rounded-lg">
                        <input type="number" id="umur" placeholder="Umur" class="p-3 border rounded-lg" required>
                        <input type="text" id="pekerjaan" placeholder="Pekerjaan (opsional)" class="p-3 border rounded-lg">
                    </div>
                    <textarea id="keluhan" placeholder="Keluhan utama (opsional)" class="w-full mt-4 p-3 border rounded-lg"></textarea>
                    <div class="mt-6 flex justify-between">
                        <button onclick="prevStep(2)" class="text-slate-500 hover:text-slate-800 font-medium px-4 py-2 rounded-lg hover:bg-slate-100 transition">
                            <i class="fas fa-arrow-left mr-2"></i> Kembali
                        </button>
                        <button onclick="calculateAndShowResult()" class="btn-primary text-white font-medium py-3 px-6 rounded-xl shadow-md">
                            Tampilkan hasil gejala <i class="fas fa-chevron-right ml-2"></i>
                        </button>
                    </div>
                </div>
            </section>

            <section id="step-result" class="step-section">
                <div class="max-w-4xl mx-auto space-y-8">
                    
                    <div id="crisis-banner" class="hidden bg-red-600 text-white p-6 rounded-2xl shadow-lg border-l-8 border-red-800 animate-pulse-slow">
                        <div class="flex items-start">
                            <i class="fas fa-exclamation-triangle text-3xl mr-4 mt-1"></i>
                            <div>
                                <h3 class="text-xl font-bold mb-1">PERINGATAN KRISIS TERDETEKSI</h3>
                                <p class="mb-3">Anda mengindikasikan adanya pemikiran untuk menyakiti diri sendiri. Mohon jangan abaikan perasaan ini.</p>
                                <div class="bg-white/20 p-3 rounded-lg inline-block">
                                    <i class="fas fa-phone-alt mr-2"></i> <strong>Layanan Darurat (Indonesia): 119 / 112</strong>
                                </div>
                                <p class="text-sm mt-2 opacity-90">Atau hubungi "LISA" (Love Inside Suicide Awareness): +62 811 3855 472</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-3xl shadow-xl overflow-hidden border border-slate-100">
                        <div id="result-header" class="bg-mindful p-10 text-center text-white relative overflow-hidden">
                            <div class="relative z-10">
                                <p class="text-sm uppercase tracking-widest opacity-80 mb-2">Hasil Screening Awal</p>
                                <h2 id="result-category" class="text-4xl font-heading font-bold mb-4">Menganalisis...</h2>
                                <div class="inline-flex items-center bg-white/20 backdrop-blur px-4 py-2 rounded-full">
                                    <span id="result-score" class="font-mono font-bold text-xl">Score: 0</span>
                                </div>
                            </div>
                            <div class="absolute top-0 left-0 w-32 h-32 bg-white/10 rounded-full -translate-x-10 -translate-y-10"></div>
                            <div class="absolute bottom-0 right-0 w-40 h-40 bg-white/10 rounded-full translate-x-10 translate-y-10"></div>
                        </div>

                        <div class="p-8">
                            <div class="mb-8">
                                <h3 class="text-xl font-bold text-slate-800 mb-3 flex items-center">
                                    <i class="fas fa-notes-medical text-mindful mr-2"></i> Interpretasi
                                </h3>
                                <p id="result-description" class="text-slate-600 leading-relaxed bg-slate-50 p-5 rounded-xl border border-slate-100">
                                    -
                                </p>
                            </div>

                            <div class="grid md:grid-cols-2 gap-8">
                                <div>
                                    <h3 class="text-lg font-bold text-slate-800 mb-3">Rekomendasi Tindakan</h3>
                                    <ul id="recommendation-list" class="space-y-3 text-sm text-slate-600">
                                    </ul>
                                </div>

                                <div class="bg-calm-light/30 p-5 rounded-xl border border-calm-light flex flex-col h-full">
    <h3 class="text-lg font-bold text-slate-800 mb-3 flex items-center">
        <i class="fas fa-map-marker-alt text-calm-dark mr-2"></i> Cari Bantuan Profesional
    </h3>
    
    <div class="space-y-3 text-sm flex-grow">
        <p class="text-slate-600 text-xs mb-2">
            MindCare tidak berafiliasi dengan RS manapun. Gunakan tombol di bawah untuk menemukan bantuan terdekat dari lokasimu saat ini.
        </p>

        <a href="https://www.google.com/maps/search/psikolog+atau+psikiater+terdekat" target="_blank" class="block bg-white p-3 rounded-lg shadow-sm border border-slate-100 hover:border-calm hover:shadow-md transition group">
            <div class="flex justify-between items-center">
                <div>
                    <p class="font-bold text-slate-700 group-hover:text-calm-dark transition">Cari Psikiater Terdekat</p>
                    <p class="text-xs text-slate-500">Via Google Maps (GPS)</p>
                </div>
                <i class="fas fa-external-link-alt text-slate-400 group-hover:text-calm transition"></i>
            </div>
        </a>

        <a href="https://www.halodoc.com/tanya-dokter/kategori/kesehatan-jiwa" target="_blank" class="block bg-white p-3 rounded-lg shadow-sm border border-slate-100 hover:border-calm hover:shadow-md transition group">
            <div class="flex justify-between items-center">
                <div>
                    <p class="font-bold text-slate-700 group-hover:text-calm-dark transition">Konsultasi Online</p>
                    <p class="text-xs text-slate-500">Halodoc / Alodokter (Berbayar)</p>
                </div>
                <i class="fas fa-mobile-alt text-slate-400 group-hover:text-calm transition"></i>
            </div>
        </a>

        <div class="bg-white p-3 rounded-lg shadow-sm border border-slate-100">
            <div class="flex items-start">
                <i class="fas fa-address-card text-green-600 mt-1 mr-2"></i>
                <div>
                    <p class="font-bold text-slate-700">Pengguna BPJS?</p>
                    <p class="text-xs text-slate-500 mt-1">Silakan datang ke <strong>Faskes 1 (Puskesmas/Klinik)</strong> terdaftar Anda untuk minta rujukan ke Poli Jiwa.</p>
                </div>
            </div>
        </div>
    </div>
</div>
                            </div>

                            <div class="mt-8 bg-gradient-to-r from-mindful-light/50 to-white p-6 rounded-2xl border border-mindful/30 relative overflow-hidden group shadow-sm">
                                <div class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-mindful/10 rounded-full blur-xl"></div>
                                
                                <div class="relative z-10 text-center">
                                    <div class="flex flex-col md:flex-row justify-center items-center gap-3 mb-4">
                                        <h4 class="text-mindful-dark font-bold uppercase tracking-widest text-xs">
                                            <i class="fas fa-quote-left mr-2"></i>Afirmasi Harian
                                        </h4>
                                        
                                        <select id="quote-category" onchange="generateQuote()" class="text-xs border border-mindful/40 rounded-full px-3 py-1 bg-white text-slate-600 focus:outline-none focus:border-mindful cursor-pointer hover:bg-slate-50 transition">
                                            <option value="all">üåê Universal / Semua</option>
                                            <option value="islam">‚ò™Ô∏è Islam</option>
                                            <option value="kristen">‚úùÔ∏è Kristen / Katolik</option>
                                            <option value="buddha">‚ò∏Ô∏è Buddha</option>
                                            <option value="hindu">üïâÔ∏è Hindu</option>
                                        </select>
                                    </div>
                                    
                                    <div class="min-h-[80px] flex flex-col justify-center">
                                        <p id="quote-text" class="text-lg md:text-xl font-heading font-semibold text-slate-700 italic mb-2 transition-all duration-500">
                                            "..."
                                        </p>
                                        <p id="quote-author" class="text-sm text-slate-500 font-medium transition-all duration-500">
                                            - MindCare AI
                                        </p>
                                    </div>

                                    <button onclick="generateQuote()" class="mt-4 text-xs text-mindful hover:text-mindful-dark font-semibold bg-white/50 px-4 py-2 rounded-full border border-transparent hover:border-mindful/30 transition shadow-sm">
                                        <i class="fas fa-sync-alt mr-1"></i> Acak Kutipan Lain
                                    </button>
                                </div>
                            </div>

                            <div class="mt-8 p-4 bg-yellow-50 border border-yellow-200 rounded-xl flex items-start">
                                <i class="fas fa-balance-scale text-yellow-600 text-xl mr-3 mt-1"></i>
                                <div>
                                    <h4 class="font-bold text-yellow-800 text-sm">DISCLAIMER (PENAFIAN)</h4>
                                    <p class="text-xs text-yellow-800 mt-1">
                                        Hasil tes ini <strong>BUKAN DIAGNOSIS MEDIS</strong>. Ini adalah alat screening awal. Diagnosis tegak hanya dapat dilakukan oleh Psikolog Klinis atau Psikiater melalui wawancara mendalam. Jangan gunakan hasil ini sebagai satu-satunya alasan untuk pengobatan mandiri.
                                    </p>
                                </div>
                            </div>

                            <div class="mt-8 flex justify-center space-x-4">
                                <button onclick="location.reload()" class="border-2 border-slate-200 text-slate-600 font-bold py-3 px-6 rounded-xl hover:bg-slate-50 transition">
                                    <i class="fas fa-redo mr-2"></i> Ulangi Tes
                                </button>
                                <button onclick="window.print()" class="bg-slate-800 text-white font-bold py-3 px-6 rounded-xl hover:bg-slate-900 transition">
                                    <i class="fas fa-print mr-2"></i> Simpan Hasil
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

        </div>
    </main>

    <footer class="bg-slate-900 text-slate-300 py-12">
        <div class="max-w-6xl mx-auto px-6 grid md:grid-cols-4 gap-8 text-sm">
            <div class="col-span-1 md:col-span-2">
                <div class="flex items-center space-x-2 mb-4">
                    <i class="fas fa-brain text-mindful-light text-2xl"></i>
                    <span class="text-xl font-bold text-white">MindCare</span>
                </div>
                <p class="mb-4 max-w-sm">Platform sistem pakar berbasis web untuk deteksi dini depresi menggunakan metode forward chaining dan standar DSM-5.</p>
            </div>
            <div>
                <h4 class="text-white font-bold mb-4 uppercase tracking-wider">Tautan</h4>
                <ul class="space-y-2">
                    <li><a href="./diagnosa.html#home" class="hover:text-mindful transition">Beranda</a></li>
                    <li><a href="./diagnosa.html#about" class="hover:text-mindful transition">Tentang Kami</a></li>
                    <li><a href="./privacy.html" class="hover:text-mindful transition">Kebijakan Privasi</a></li>
                </ul>
            </div>
            <div>
                <h4 class="text-white font-bold mb-4 uppercase tracking-wider">Kontak Darurat</h4>
                <p class="mb-2"><i class="fas fa-phone mr-2"></i> 119 (Ambulans)</p>
                <p><i class="fas fa-headset mr-2"></i> 1-500-454 (Kemenkes)</p>
            </div>
        </div>
        <div class="max-w-6xl mx-auto px-6 mt-12 pt-8 border-t border-slate-800 text-center text-xs text-slate-500">
            &copy; 2025 MindCare Expert System. All Rights Reserved.
        </div>
    </footer>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        AOS.init({ duration: 800, once: true });

        // --- DATA GEJALA (PHQ-9 Standard) ---
        const gejalaList = [
            { kode: "C1", nama: "Kurang berminat atau bergairah dalam melakukan apapun" },
            { kode: "C2", nama: "Merasa murung, sedih, atau putus asa" },
            { kode: "C3", nama: "Sulit tidur atau mudah terbangun, atau terlalu banyak tidur" },
            { kode: "C4", nama: "Merasa lelah atau kurang bertenaga" },
            { kode: "C5", nama: "Kurang nafsu makan atau terlalu banyak makan" },
            { kode: "C6", nama: "Kurang percaya diri ‚Äî atau merasa bahwa Anda adalah orang yang gagal atau telah mengecewakan diri sendiri atau keluarga" },
            { kode: "C7", nama: "Sulit berkonsentrasi pada sesuatu, misalnya membaca koran atau menonton televisi" },
            { kode: "C8", nama: "Bergerak atau berbicara sangat lambat sehingga orang lain memperhatikannya. Atau sebaliknya - merasa resah atau gelisah sehingga Anda lebih sering bergerak dari biasanya" },
            { kode: "C9", nama: "Merasa lebih baik mati atau ingin melukai diri sendiri dengan cara apapun" }
        ];

        // --- DATABASE KUTIPAN LINTAS AGAMA ---
        const interfaithQuotes = [
            // --- ISLAM ---
            { text: "Maka sesungguhnya bersama kesulitan ada kemudahan.", author: "QS. Al-Insyirah: 5-6", category: "islam" },
            { text: "Janganlah kamu berduka cita, sesungguhnya Allah bersama kita.", author: "QS. At-Taubah: 40", category: "islam" },
            { text: "Allah tidak membebani seseorang melainkan sesuai dengan kesanggupannya.", author: "QS. Al-Baqarah: 286", category: "islam" },
            { text: "Sesungguhnya pertolongan Allah itu dekat.", author: "QS. Al-Baqarah: 214", category: "islam" },
            
            // // --- KRISTEN / KATOLIK ---
            // { text: "Segala perkara dapat kutanggung di dalam Dia yang memberi kekuatan kepadaku.", author: "Filipi 4:13", category: "kristen" },
            // { text: "Serahkanlah segala kekuatiranmu kepada-Nya, sebab Ia yang memelihara kamu.", author: "1 Petrus 5:7", category: "kristen" },
            // { text: "Tuhan itu dekat kepada orang-orang yang patah hati.", author: "Mazmur 34:18", category: "kristen" },
            // { text: "Marilah kepada-Ku, semua yang letih lesu dan berbeban berat, Aku akan memberi kelegaan kepadamu.", author: "Matius 11:28", category: "kristen" },

            // // --- BUDDHA ---
            // { text: "Rasa sakit itu pasti, tapi menderita adalah pilihan.", author: "Buddha Gautama", category: "buddha" },
            // { text: "Kedamaian datang dari dalam. Jangan mencarinya di luar.", author: "Buddha Gautama", category: "buddha" },
            // { text: "Tidak ada yang bisa menyelamatkan kita kecuali diri kita sendiri.", author: "Buddha Gautama", category: "buddha" },
            
            // // --- HINDU ---
            // { text: "Kamu berhak atas pekerjaanmu, tetapi tidak atas hasilnya. Jangan biarkan hasil jadi motivasimu.", author: "Bhagavad Gita", category: "hindu" },
            // { text: "Ketenangan pikiran adalah yoga yang tertinggi.", author: "Swami Sivananda", category: "hindu" },
            // { text: "Perubahan adalah hukum dunia.", author: "Bhagavad Gita", category: "hindu" },

            // --- UNIVERSAL / STOIC (Netral) ---
            { text: "Kita lebih sering menderita dalam imajinasi kita daripada dalam kenyataan.", author: "Seneca", category: "universal" },
            { text: "Badai pasti berlalu, dan kamu akan tetap berdiri.", author: "MindCare", category: "universal" },
            { text: "Tidak apa-apa untuk istirahat sejenak. Kamu sedang berjuang.", author: "MindCare", category: "universal" },
            { text: "Kamu lebih kuat dari yang kamu tahu.", author: "Anonim", category: "universal" },
            { text: "Penyembuhan membutuhkan waktu, bersabarlah dengan dirimu sendiri.", author: "MindCare", category: "universal" }
        ];

        let currentAnswers = {};
        
        // --- LOGIC: Navigation & UI ---
        document.addEventListener('DOMContentLoaded', () => {
            renderQuestions();
            updateProgress(1);
            setupLimitCheckboxes(); 
        });

        function nextStep(step) {
            document.querySelectorAll('.step-section').forEach(el => el.classList.remove('active'));
            document.getElementById(`step-${step}`).classList.add('active');
            updateProgress(step);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function prevStep(step) {
            nextStep(step);
        }

        function updateProgress(step) {
            let percentage = 0;
            let text = "";
            
            if(step === 1) { percentage = 10; text = "Langkah 1: Pendahuluan"; }
            else if(step === 2) { percentage = 40; text = "Langkah 2: Kuesioner Gejala"; }
            else if(step === 3) { percentage = 70; text = "Langkah 3: Data Diri"; }
            else if(step === 'result') { percentage = 100; text = "Selesai"; }
            
            document.getElementById('step-indicator').textContent = text;
            document.getElementById('step-percentage').textContent = `${percentage}%`;
            document.getElementById('progress-fill').style.width = `${percentage}%`;
        }

        // --- LOGIC: Questionnaire UI ---
        function renderQuestions() {
            const container = document.getElementById('question-container');
            let html = '';
            
            gejalaList.forEach((g, index) => {
                html += `
                <div class="question-item bg-white" data-index="${index}">
                    <div class="flex items-start mb-6">
                        <div class="flex-shrink-0 bg-mindful-light text-mindful-dark font-bold rounded-xl w-10 h-10 flex items-center justify-center mr-4 mt-1">
                            ${index + 1}
                        </div>
                        <div class="flex-grow">
                            <h3 class="text-lg font-medium text-slate-800 mb-6">${g.nama}</h3>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                ${renderOption(g.kode, 0, "Tidak Pernah", "fa-times", "text-slate-500")}
                                ${renderOption(g.kode, 1, "Beberapa Hari", "fa-calendar-minus", "text-blue-500")}
                                ${renderOption(g.kode, 2, "> Seminggu", "fa-calendar-week", "text-amber-500")}
                                ${renderOption(g.kode, 3, "Hampir Tiap Hari", "fa-calendar-day", "text-red-500")}
                            </div>
                        </div>
                    </div>
                    ${index < gejalaList.length - 1 ? '<hr class="border-slate-100">' : ''}
                </div>`;
            });
            container.innerHTML = html;
        }

        function renderOption(name, value, label, icon, iconColor) {
            const isChecked = currentAnswers[name] === value ? 'checked' : '';
            return `
            <div class="relative h-full">
                <input type="radio" name="${name}" value="${value}" id="${name}-${value}" 
                       class="custom-radio" onchange="saveAnswer('${name}', ${value})" ${isChecked}>
                <label for="${name}-${value}" class="radio-option cursor-pointer flex flex-col items-center justify-center h-full w-full">
                    <i class="fas ${icon} ${iconColor} text-xl mb-2"></i>
                    <span class="font-medium text-sm">${label}</span>
                </label>
            </div>`;
        }

        function saveAnswer(code, val) {
            currentAnswers[code] = val;
            const currentIndex = gejalaList.findIndex(item => item.kode === code);
            if (currentIndex !== -1) {
                setTimeout(() => {
                    if (currentIndex < gejalaList.length - 1) {
                        const nextIndex = currentIndex + 1;
                        const nextElement = document.querySelector(`.question-item[data-index="${nextIndex}"]`);
                        if (nextElement) nextElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else {
                        const nextButton = document.querySelector('button[onclick="validateAndNext(3)"]');
                        if (nextButton) nextButton.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }, 300); 
            }
        }

        function validateAndNext(step) {
            if(Object.keys(currentAnswers).length < gejalaList.length) {
                alert("Mohon lengkapi semua pertanyaan kuesioner sebelum melanjutkan.");
                return;
            }
            nextStep(step);
        }

        function setupLimitCheckboxes() {
            const reasonChecks = document.querySelectorAll('.limit-3');
            reasonChecks.forEach(check => {
                check.addEventListener('change', function() {
                    const checkedCount = document.querySelectorAll('.limit-3:checked').length;
                    if(checkedCount > 3) {
                        this.checked = false;
                        alert("Maksimal pilih 3 alasan.");
                    }
                });
            });
        }

        // --- LOGIC: GENERATOR KUTIPAN ---
        function generateQuote() {
            const textEl = document.getElementById('quote-text');
            const authorEl = document.getElementById('quote-author');
            const categorySelect = document.getElementById('quote-category');
            
            if(!textEl || !authorEl) return;

            const selectedCategory = categorySelect ? categorySelect.value : 'all';

            let filteredQuotes;
            if (selectedCategory === 'all') {
                filteredQuotes = interfaithQuotes;
            } else {
                filteredQuotes = interfaithQuotes.filter(q => 
                    q.category === selectedCategory || q.category === 'universal'
                );
            }

            if (filteredQuotes.length === 0) filteredQuotes = interfaithQuotes;

            textEl.style.opacity = 0;
            authorEl.style.opacity = 0;
            
            setTimeout(() => {
                const randomItem = filteredQuotes[Math.floor(Math.random() * filteredQuotes.length)];
                textEl.textContent = `"${randomItem.text}"`;
                authorEl.textContent = `- ${randomItem.author}`;
                textEl.style.opacity = 1;
                authorEl.style.opacity = 1;
            }, 300);
        }

        // --- LOGIC: SUBMIT & CALCULATE ---
        async function calculateAndShowResult() {
            document.querySelectorAll('.step-section').forEach(el => el.classList.remove('active'));
            document.getElementById('step-result').classList.add('active');
            
            const btnSubmit = document.querySelector('button[onclick="calculateAndShowResult()"]');
            const originalText = btnSubmit.innerHTML;
            btnSubmit.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Menganalisis...';
            btnSubmit.disabled = true;

            try {
                const identitas = {
                    nama: document.getElementById('nama')?.value?.trim() || 'Anonim',
                    email: document.getElementById('email')?.value?.trim() || null
                };

                if (!identitas.nama) {
                    alert('Mohon isi nama sebelum melihat hasil.');
                    nextStep(3);
                    return;
                }

                const response = await fetch('/api/public/diagnosis/submit', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        jawaban: currentAnswers,
                        nama: document.getElementById('nama')?.value?.trim() || 'Anonim',
                        email: document.getElementById('email')?.value?.trim() || null,
                        umur: Number(document.getElementById('umur')?.value) || null,
                        keluhan: document.getElementById('keluhan')?.value?.trim() || null
                    })
                });

                if (!response.ok) {
                    const text = await response.text();
                    throw new Error(text || 'Response server gagal');
                }

                const resultJson = await response.json();
                
                if (!resultJson.success) {
                    throw new Error(resultJson.message || 'Diagnosis gagal');
                }

                const data = resultJson;

                // Update UI Hasil
                document.getElementById('result-category').textContent = data.kategori;
                document.getElementById('result-score').textContent = `Total Skor PHQ-9: ${data.score}`;
                document.getElementById('result-description').textContent = data.deskripsi;

                const recList = document.getElementById('recommendation-list');
                recList.innerHTML = "";
                data.rekomendasi.forEach(r => {
                    recList.innerHTML += `<li>‚Ä¢ ${r}</li>`;
                });

                if (data.krisis) {
                    document.getElementById('crisis-banner').classList.remove('hidden');
                } else {
                    document.getElementById('crisis-banner').classList.add('hidden');
                }

                // PANGGIL GENERATOR KUTIPAN SEBELUM TAMPIL
                generateQuote();

                nextStep('result');

            } catch (err) {
                console.error('Error koneksi:', err);
                alert(err.message);
            } finally {
                btnSubmit.innerHTML = originalText;
                btnSubmit.disabled = false;
            }
        }
    </script>
</body>
</html>